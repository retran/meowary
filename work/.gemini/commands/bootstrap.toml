description = "First-time setup or update personal context"

prompt = """
Set up or revise the personal context file (`meta/context.md`). This command is idempotent: if context already exists, present it for review and update; if it's missing or empty, walk the user through filling it in from scratch.

## Step 1: Check Current State

- Read `meta/context.md`.
- If the file exists and has content (non-empty Author section), go to **Step 2a** (revision flow).
- If the file is missing, empty, or has only the template skeleton with no values filled in, go to **Step 2b** (fresh setup).

## Step 2a: Revision Flow (context exists)

- Show the user the current context in a readable format.
- Ask: "Is this still accurate? What would you like to update?"
- Let the user change any fields: name, role, team, department, product, tooling, conventions.
- Update `meta/context.md` with the revised values.
- Skip to **Step 4**.

## Step 2b: Fresh Setup (no context)

Ask the user the following questions. Ask them all at once to reduce back-and-forth, but make it clear each is important:

1. **Name** -- full name for the journal author
2. **Role** -- job title (e.g. "Senior Developer", "Engineering Manager")
3. **Team** -- immediate team name and abbreviation if any
4. **Department / Product** -- broader org unit and product area
5. **Tooling** -- what MCP integrations are configured? (Jira/Confluence, GitHub, Calendar, etc.) What Atlassian instance? Any external workspace paths the agent should know about?
6. **Conventions** -- preferred language, work week (Mon-Fri?), time format, week numbering

## Step 3: Write Context File

Write `meta/context.md` with the collected information, following this structure:

```markdown
# Meowary Context

Personal and work-specific context for this Meowary instance. The agent reads this file to understand who the author is, what team they work in, and how their tooling is configured. AGENTS.md references this file -- it should not contain author-specific information itself.

If this file is empty or missing sections, the agent should ask the user to fill them in before proceeding with tasks that need the context.

## Author

- **Name:** <full name>
- **Role:** <job title>
- **Department:** <department, company>
- **Product:** <product area>
- **Team:** <team name>

## Tooling

- **Editor/Agent:** Gemini CLI
- **MCP integrations:** <list of integrations>
- **Atlassian instance:** <instance URL if applicable>
- **External workspaces:** <paths if applicable>

## Conventions

- **Language:** <language for journal content>
- **Work week:** <e.g. Monday--Friday>
- **Time format:** <e.g. 24-hour>
- **Week numbering:** ISO 8601 (weeks start on Monday)
```

Adapt sections as needed -- add fields the user mentions, omit fields that don't apply.

## Step 4: Verify Tooling Connections

If the user mentioned MCP integrations (Jira, Confluence, etc.), do a quick smoke test:

- For Jira: try listing projects to confirm the connection works.
- For Confluence: try a simple search to confirm the connection works.
- Report results to the user. If something fails, note it but don't block -- the user can fix configuration later.

## Step 5: Create Author KB Entry (fresh setup only)

If this is a fresh setup (Step 2b), offer to create a knowledge base entry for the author:

- Create `knowledge-base/people/<slug>.md` from `meta/templates/person-template.md`.
- Fill in the known details (name, role, team).
- Add a link from `meta/context.md` to the KB entry.
- Register the `#person-<slug>` tag in `meta/tags.md` if it doesn't exist.

## Step 6: Summary

- Show the user what was created or updated.
- Remind them of next steps: `/morning` to start the day, `/week-plan` on Mondays.
- Commit changes with a descriptive message (e.g. "Bootstrap Meowary context for <name>" or "Update Meowary context").

{{args}}
"""
