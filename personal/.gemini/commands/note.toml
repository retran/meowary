description = "Record a note (conversation, idea, research, appointment)"

prompt = """
Record a note. This can be anything: a conversation, an idea, research findings, an appointment summary, or any other freeform note. This is an interactive process -- ask questions at each step before moving on.

Arguments: if a project slug is provided, the note is appended to that project's `notes.md`. Otherwise, ask the user.

## Step 1: Note Details

Ask the user for (skip any already provided via arguments):

- **Title:** What is this note about? (e.g. "Sourdough starter experiment", "Call with doctor", "Bike route research")
- **Project:** Is this tied to a project? If yes, which one? (List active projects from `projects/` for the user to pick.) If no project, the note goes into the `notes/` folder.
- **People:** Anyone involved? Use `#person-` tags and link to KB people entries where they exist. Skip if not applicable.

## Step 2: Note-Taking

Present the note template structure and ask the user to provide content for each section:

1. **Details** -- the substance of the note. Ask: "What are the details?" Write as bullet points.
2. **Takeaways** -- key insights or conclusions. Ask: "Any takeaways or key points?" Write as bullet points. If none, write `*(none)*`.
3. **Action Items** -- things to do as a result. Ask: "Any action items or follow-ups?" Write as checkboxes (`- [ ]`). Tag each with the responsible person (`#person-`) and project (`#p-`) if applicable.

## Step 3: Write the Note

**If project note** (project slug was provided or chosen):
- Check if `projects/<slug>/notes.md` exists. If not, create it with an H1 heading: `# <Project Name> -- Notes`.
- Append the note entry using the format from `meta/templates/note-template.md`. The entry starts with an H2 heading: `## YYYY-MM-DD: <Title>`.
- Entries are in reverse chronological order (newest first, right after the H1 heading).

**If general note** (no project):
- Create a standalone file: `notes/YYYY-MM-DD-<slug>.md` where `<slug>` is a kebab-case version of the title.
- Use a standalone format with an H1 heading: `# YYYY-MM-DD: <Title>`, followed by metadata (People, Tags) and the same Details/Takeaways/Action Items sections.

## Step 4: Cross-Link

- If today's daily note exists, add or update the **Log & Notes** section (or **Events & Appointments** if it was an event/appointment) with a link to the note and a one-line summary.
- Tag the daily note entry with relevant `#p-` and `#person-` tags.
- If action items reference specific projects, add them as tasks in those projects' Open Tasks sections.

## Step 5: Knowledge Base Updates

- If durable facts were learned (health info, place recommendations, person details, topic knowledge), update the relevant knowledge base entries. Create new entries if needed.
- Append a changelog entry to any KB article that is edited.

## Step 6: Commit

- Once the user confirms the note is complete, commit with a message like "Add note: <title> (YYYY-MM-DD)".

{{args}}
"""
